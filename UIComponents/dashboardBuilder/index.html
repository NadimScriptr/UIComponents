<html ng-app="myApp">
<head>
    <link rel="shortcut icon" type="image/x-icon" href="https://www.scriptr.io/themes/scriptr/images/favicon.ico">
    <title>Dashboard Builder</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="//use.fontawesome.com/cb4ba0acea.js"></script>  
  
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
    <link rel="stylesheet" href="/UIComponents/dashboard/frontend/components/chart/chart.css">
    <link rel="stylesheet" href="/UIComponents/dashboard/frontend/components/searchBox/abn_tree.css">
    <link rel="stylesheet" href="/UIComponents/dashboardBuilder/lib/gridster/angular_gridster.min.css">
    <link rel="stylesheet" href="//cdn.gitcdn.link/cdn/angular/bower-material/v1.1.3/angular-material.css">
    <link rel="stylesheet" href="/UIComponents/dashboard/frontend/components/odometer/odometer.car.css">
    <link rel="stylesheet" href="/UIComponents/dashboard/frontend/components/thermometer/style.css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/angular-xeditable/0.7.0/css/xeditable.css" rel="stylesheet">
    <link rel="stylesheet" href="/UIComponents/dashboardBuilder/css/dashboard.css">
  
    <!-- JQUERY Material-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>
    <script  src="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js"></script>
  
    <!-- Libraries -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>	
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.js"></script>
    <script src="//maps.google.com/maps/api/js?key=AIzaSyBcPYghFh_BXz4dDz-TXTHbU2iV3Wbf57I&libraries=drawing"></script>
  
    <!-- Login -->
    <script src="/modules/login/widgets/authorization.js"> </script>
  
    <!-- NG material -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-route.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-cookies.js"></script>
    <script src="//cdn.rawgit.com/gdi2290/angular-websocket/v1.0.9/angular-websocket.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-slick-carousel/3.1.7/angular-slick.min.js"></script>
    <script src="/UIComponents/dashboardBuilder/lib/gridster/angular_gridster.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-animate.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-sanitize.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.0/ui-bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.0/ui-bootstrap-tpls.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>      
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script> 
    <script src="//cdn.gitcdn.link/cdn/angular/bower-material/v1.1.3/angular-material.js"></script> 
    <script src="//s3-us-west-2.amazonaws.com/s.cdpn.io/t-114/svg-assets-cache.js"></script> 
    <script src="/UIComponents/dashboard/frontend/components/map/markerClusterer.js"></script>
  
    <!-- Directives -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/chart/angular.morris.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/justgage/1.2.2/justgage.min.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/gauge/angular.gauge.min.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/speedometer/angular.metergauge.min.js"></script>
  	<script src="//d3js.org/d3.v4.min.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/odometer/odometer.min.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/odometer/angular.odometer.min.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/searchBox/abn_tree_directive.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/thermometer/thermometer_directive.js"></script>
    <script src="//rawgit.com/allenhwkim/angularjs-google-maps/master/build/scripts/ng-map.js"></script>
  
    <!-- Compoenents -->
    <script src="/UIComponents/wsProvider.js"></script>
    <script src="/UIComponents/httpProvider.js"></script>
    <script src="/UIComponents/config/scriptrTransport.js"></script>    
    <script src="/UIComponents/dashboard/frontend/components/chart/chart.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/odometer/odometer.js"></script>
    <script src="/UIComponents/dashboardBuilder/lib/schemaForm/tv4.js"></script>
    <script src="/UIComponents/dashboardBuilder/lib/schemaForm/objectPath.js"></script>
    <script src="/UIComponents/dashboardBuilder/lib/schemaForm/schemaForm.js"></script>
    <script src="/UIComponents/dashboardBuilder/lib/schemaForm/bootstrapDecorator.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/speedometer/speedometer.js"></script>
    <script src="/UIComponents/dashboardBuilder/javascript/components/module.js"></script>
    <script src="/UIComponents/dashboardBuilder/javascript/components/library/widgetsConfig.js"></script>
    <script src="/UIComponents/dashboardBuilder/javascript/components/dashboard.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/searchBox/searchBox.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/gauge/gauge.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/message/displayBox.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/message/message.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/thermometer/thermometer.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/progressBar/progressBar.js"></script>  
  
    <script src="/UIComponents/dashboard/frontend/components/map/map.js"></script>
    
    <script src="/UIComponents/dashboardBuilder/javascript/config/config.js"></script>
  
    <link href="/UIComponents/dashboard/frontend/components/toggleSwitch/angular_toggle_switch.css" media="all" rel="stylesheet" type="text/css">
    <script src="/UIComponents/dashboard/frontend/components/toggleSwitch/angular_toggle_switch.js"></script>
  
   <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-xeditable/0.7.0/js/xeditable.js"></script>
  
    <script src="/UIComponents/dashboard/frontend/components/publisher/publisherComponent.js"></script>
                              
        
</head> 
  
  <script type="text/javascript"> 
    var authorization  = $.scriptr.authorization(
        {
          onTokenValid: function(){ }, 
          loginPage: login.loginTarget
        }
      );
  </script>
  
<script>
     var myApp= angular.module("myApp", ['DashboardBuilder']);
     angular.module('myApp').config(wssConfig);
     angular.module('myApp').config(httpsConfig);
     angular.module('myApp').run(function(editableOptions, editableThemes) {
        editableThemes.bs3.inputClass = 'input-sm';
        editableThemes.bs3.buttonsClass = 'btn-md';
        editableThemes.bs3.submitTpl = '<button type="submit" class="btn btn-warning" title="Submit" aria-label="Submit"><span class="glyphicon glyphicon-ok"></span></button>';
        editableOptions.theme = 'bs3'; // bootstrap3 theme. Can be also 'bs2', 'default'
     });
  
    
     angular.module('myApp').config(function($routeProvider){
           $routeProvider
            .when("/", {
            	templateUrl: '/UIComponents/dashboardBuilder/view/dashboard.html'
          	})
            .when("/scriptrIdeRef/:scriptrIdeRef*", {
            	templateUrl: '/UIComponents/dashboardBuilder/view/dashboard.html'
          	})
          	.when('/scriptName/:scriptName*', {
              	templateUrl: '/UIComponents/dashboardBuilder/view/dashboard.html',
             	controller:  'mapCtrl',
              	controllerAs: "vm"
            }) 
            .otherwise({redirectTo:'/'})
       })
   	  angular.module('myApp').controller('mapCtrl', function($scope, httpClient, $sce, $route, $routeParams) {
          var vm = this;
          
          vm.init = function(){
            vm.dashboardCounter = 1;
            vm.mainScriptName = "creatorWizard/scripts/dashbaord";
            vm.scriptName = "creatorWizard/scripts/dashbaord";
            vm.showDashboard = false;
            vm.dashboardScriptName = "/" +  vm.scriptName;
            vm.switchStatus = false;
            httpClient
                 .get("UIComponents/dashboardBuilder/backend/api/loadScripts", {})
                 .then(
                 function(data, response) {
                   if(data && data.documents){
                         vm.customDahboards = data.documents;
                         vm.dashboardCounter = parseInt(data.aggregate.pageScope.value) + 1;
                   }else{
                     console.log("No data found");
                   }
                 },
                 function(err) {
                   console
                     .log(
                     "reject published promise",
                     err);
                 });
          }
          vm.trustSrc = function(src) {
            return $sce.trustAsResourceUrl(src);
          }
          vm.addCustomDashboard = function(){
              vm.showDashboard = true;
              vm.switchStatus = true;
              vm.scriptName = vm.mainScriptName;
              vm.scriptName += "_" + vm.dashboardCounter;
              vm.dashboardScriptName = login.baseURL + vm.scriptName;
          }
          vm.showCustomDashboard = function(scriptName){
               vm.showDashboard = true;
               vm.scriptName = scriptName;
               vm.switchStatus = false;
               vm.dashboardScriptName = "/" + vm.scriptName;
          }
          vm.homeCallback = function(data){
              if(data && data.documents){
                vm.customDahboards = data.documents;
                vm.dashboardCounter = parseInt(data.aggregate.pageScope.value) + 1;
              }else{
                console.log("No data found");
              }
          }
          vm.deleteDashboard = function(path){
                 console.log(name, path);
              var params = {
                "path" : path,
                "name" : name
              }
              
              vm = this;
              httpClient
               .get("UIComponents/dashboardBuilder/backend/api/deleteDashboard", params)
               .then(
               function(data, response) {
                   console.log("success");
                   for(var i = 0; i < vm.customDahboards.length; i++){
                     if(vm.customDahboards[i].path == data){
                       vm.customDahboards.splice(i, 1);
                       break;
                     }
                   }
               },
               function(err) {
                 console
                   .log(
                   "reject published promise",
                   err);
               });
            }
           
            vm.renameDashboard = function(name, path){
              console.log(name, path);
              var params = {
                "path" : path,
                "name" : name
              }
              httpClient
               .get("UIComponents/dashboardBuilder/backend/api/renameDashboard", params)
               .then(
               function(data, response) {
                   console.log("success");
               },
               function(err) {
                 console
                   .log(
                   "reject published promise",
                   err);
               });
            }
          
      });
  
  
</script>
  
<!--script src="/UIComponents/dashboardBuilder/javascript/dashboard.js"></script-->
<body ng-app="myApp" ng-controller="mapCtrl as vm">
  <ng-view></ng-view>
  <div ng-include="'/UIComponents/dashboardBuilder/view/dashboardTemplate'"></div>
</body>  
</html>