var documents = require("document");
var params = request.parameters;
var columnName = params.columnName;
var resultsPerPage = params.resultsPerPage;
var pageNumber = params.pageNumber;
var sort = params.sort;
var sortType = params.sortType;
var queryFilter = params.queryFilter;
var queryType = params.queryType;
var sortingColumnName = params.sortingColumnName;
var filterColumnName = params.filterColumnName;

var results;

var queryParams = {};
if(sortType == null) sortType = "string"
var fieldsParams = "name, model, price";
var queryString = 'formType = "cars"';
var sortString = (sortingColumnName && sortingColumnName != "" && sortingColumnName != "undefined") ? sortingColumnName+"<"+sortType+":"+sort+">" : null;

queryParams["count"] = "true";
queryParams["query"] =  queryString;
if(queryFilter){
  var filterQuery = (filterColumnName == null)? "and (name like \"" +queryFilter+ "%\" or model like \"" +queryFilter+ "%\" or price like \"" +queryFilter+ "%\")" : "and ("+filterColumnName+"<"+sortType+">" + " like \"" +queryFilter+ "%\")";
  queryParams["query"] += filterQuery;
}
queryParams["fields"] =  fieldsParams;
if(sortString){
  queryParams["sort"] = sortString;
}
if(resultsPerPage){
  queryParams["resultsPerPage"] = resultsPerPage;
}
if(pageNumber){
  queryParams["pageNumber"] = pageNumber;
}

results = documents.query(queryParams);

return results.result